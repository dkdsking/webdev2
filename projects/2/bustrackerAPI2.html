<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CTA BUS TRACKER API</title>
  <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Mada" rel="stylesheet">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_purple-blue.min.css" />
  <style>
  .demo-list-item {
      width: 300px;
    }
  </style>
</head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
  <header class="mdl-layout__header">
    <div class="mdl-layout__header-row">
      <!-- Title -->
      <span class="mdl-layout-title">CTA BUS TRACKER</span>
      <!-- Add spacer, to align navigation to the right -->
      <div class="mdl-layout-spacer"></div>
    </div>
  </header>
  <main class="mdl-layout__content">
    <div class="page-content">
      <h3>CTA Bus Times</h3>
      <h4>Click one of the buttons below to display the bus arrival predictions for that route. <br>
      Note: All four of these options are for the Western and Addison intersection.</h4>
      <!-- Colored raised button -->
      <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" id="northBound">
        Northbound 49/X49 Western
      </button>
      <!-- Colored raised button -->
      <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" id="southBound">
        Southbound 49/X49 Western
      </button>
      <!-- Colored raised button -->
      <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" id="eastBound">
        Eastbound 152 Addison
      </button>
      <!-- Colored raised button -->
      <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" id="westBound">
        Westbound 152 Addison
      </button>
        <div>
          <ul class="demo-list-item mdl-list"  id="results">
            
          </ul>
        </div>
    </div>
  </main>
</div>
  <script>
        $("#northBound").click(function() {
          $("#results").empty();
          $(function() {
            
            
            var apiPassThruUrl = "https://polar-garden-75406.herokuapp.com/apiPassThru.php";
            
            var apiEndpoint = "http://www.ctabustracker.com/bustime/api/v2/getpredictions";
            
            $.ajax({
                url: apiPassThruUrl,
                dataType: "json",
                method: 'GET',
                data: {"apiEndpoint": apiEndpoint,
                        "key" : "YubEefJ33AeRRyxbmYBbgN2QH",
                        "format":"json",
                        "stpid": 8417}
              }).done (function (data) {
                //console.log(url);
                console.log(data);
                $("#results").append("<li class='mdl-list__item'><span class='mdl-list__item-primary-content'><h5>Bus Predictions</h5></span></li>");
               
                $.each (data["bustime-response"]["prd"], function(index,value) {
                    var prediction = value.prdctdn;
                    if (prediction !== "DLY" && prediction !=="DUE" ) {
                      minuteString = " MINUTES";
                      var predictionNum = prediction.toString();
                      var prediction = prediction.concat(minuteString);
                    }
                    if (prediction == "DLY") {
                      var prediction = "DELAYED";
                    }
                    var delayIf = value.dly;
                    if (delayIf == true) {
                      var delayIf = "YEAH THERE IS SORRY"
                    } else {
                      var delayIf = "NOPE"
                    }
                    var html = "<li class='mdl-list__item'><span class='mdl-list__item-primary-content'>"+
                    "Bus Arrival Time: " +prediction  + "<br>"+
                    "Stop Name: " +value.stpnm+ "<br>" +
                    "Route Direction: " + value.rtdir+ "<br>" +
                    "Delay: "+delayIf+"</span></li>"
                    $("#results").append(html);
                })
    
                if ($('#results').contents().length == 0) {
                      $("#results").append("Sorry, no information was found for that stop ID. Click the link above if you want to look through the valid IDs.")
                }
  
              });
          });
        });    
  
</script>
 
</body>
</html>